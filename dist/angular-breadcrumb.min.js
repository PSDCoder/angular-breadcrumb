/*! angular-breadcrumb - v0.4.7-dev-2015-06-25
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2015 Nicolas Cuillery; Licensed MIT */
!function(a,b,c){"use strict";function d(a,c){return b.equals(a.length,c.length)?a>c:a.length>c.length}function e(a){var b={};for(var c in a.views)if(a.views.hasOwnProperty(c)){var d=a.views[c].resolve;for(var e in d)d.hasOwnProperty(e)&&"$template"!==e&&(b[e]=a.locals[c][e])}return b}function f(a){for(var c={},d=a.$current,f=[];d;)f.unshift(d),d=d.parent;for(var g=0,h=f.length;h>g;g++)b.extend(c,e(f[g]));return c}function g(a){var b=[],c={};for(var d in a.$current.views)a.$current.views.hasOwnProperty(d)&&b.push(d);return b.forEach(function(b){c[b]=a.$current.locals[b].$scope}),c}function h(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function i(){var a={prefixStateName:null,template:"bootstrap3",templateUrl:null,includeAbstract:!1};this.setOptions=function(c){b.extend(a,c)},this.$get=["$state","$stateParams","$rootScope",function(b,e,f){var g=f;f.$on("$viewContentLoaded",function(a){d(a.targetScope.$id,g.$id)&&(g=a.targetScope)});var i=function(a){var b=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1],c="object"==typeof b;return c?b.name:b},j=function(c,d){for(var f,i,j=h(d),k=!1,l=!1,m=0,n=c.length;n>m;m+=1)if(c[m].name===j.state)return;f=b.get(j.state),f.ncyBreadcrumb&&(f.ncyBreadcrumb.force&&(k=!0),f.ncyBreadcrumb.skip&&(l=!0)),f["abstract"]&&!a.includeAbstract&&!k||l||(j.paramExpr&&(i=g.$eval(j.paramExpr)),f.ncyBreadcrumbLink=b.href(j.state,i||e||{}),c.unshift(f))},k=function(a){var c=h(a),d=b.get(c.state);if(d.ncyBreadcrumb&&d.ncyBreadcrumb.parent){var e="function"==typeof d.ncyBreadcrumb.parent,f=e?d.ncyBreadcrumb.parent(g):d.ncyBreadcrumb.parent;if(f)return f}return i(d)};return{getTemplate:function(b){return a.templateUrl?null:b[a.template]?b[a.template]:a.template},getTemplateUrl:function(){return a.templateUrl},getStatesChain:function(c){for(var d=[],e=b.$current.self.name;e;e=k(e))if(j(d,e),c&&d.length)return d;return a.prefixStateName&&j(d,a.prefixStateName),d},getLastStep:function(){var a=this.getStatesChain(!0);return a.length?a[0]:c},$getLastViewScope:function(){return g}}}]}function j(a,c,d,e,h){var i={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:!0,scope:{},template:c.getTemplate(i),templateUrl:c.getTemplateUrl(),link:{post:function(i){var j=[],k=function(){o(j),j=[];var d=c.$getLastViewScope();i.steps=c.getStatesChain(),b.forEach(i.steps,function(c){if(c.ncyBreadcrumb&&c.ncyBreadcrumb.label)if(b.isFunction(c.ncyBreadcrumb.label))c.ncyBreadcrumbLabel=e.invoke(c.ncyBreadcrumb.label,null,{$scope:i,$viewScopes:g(h),$resolves:f(h)});else{var k=a(c.ncyBreadcrumb.label);c.ncyBreadcrumbLabel=k(d),n(j,k,d,c)}else c.ncyBreadcrumbLabel=c.name})};d.$on("$viewContentLoaded",function(){k()}),k()}}}}function k(a,c,d,e,h){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbLabel}}",compile:function(i,j){var k=i.attr(j.$attr.ncyBreadcrumbLast);return k&&i.html(k),{post:function(i){var j=[],k=function(){o(j),j=[];var d=c.$getLastViewScope(),k=c.getLastStep();if(k)if(i.ncyBreadcrumbLink=k.ncyBreadcrumbLink,k.ncyBreadcrumb&&k.ncyBreadcrumb.label)if(b.isFunction(k.ncyBreadcrumb.label))i.ncyBreadcrumbLabel=e.invoke(k.ncyBreadcrumb.label,null,{$scope:i,$viewScopes:g(h),$resolves:f(h)});else{var l=a(k.ncyBreadcrumb.label);i.ncyBreadcrumbLabel=l(d),n(j,l,d,i)}else i.ncyBreadcrumbLabel=k.name};d.$on("$viewContentLoaded",function(){k()}),k()}}}}}function l(a,c,d,e,h){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(i,j){var k=i.attr(j.$attr.ncyBreadcrumbText);k&&i.html(k);var l=i.attr(j.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(i){var j=[],k=function(a,c,d){b.forEach(m(c),function(b){var c=d.$watch(b,function(a,b){a!==b&&n()});a.push(c)})},n=function(){o(j),j=[];var d=c.$getLastViewScope(),m=c.getStatesChain(),n=[];b.forEach(m,function(c){if(c.ncyBreadcrumb&&c.ncyBreadcrumb.label)if(b.isFunction(c.ncyBreadcrumb.label))n.push(e.invoke(c.ncyBreadcrumb.label,null,{$scope:i,$viewScopes:g(h),$resolves:f(h)}));else{var l=a(c.ncyBreadcrumb.label);n.push(l(d)),k(j,l,d)}else n.push(c.name)}),i.ncyBreadcrumbChain=n.join(l)};d.$on("$viewContentLoaded",function(){n()}),n()}}}}}var m=function(a){if(a.expressions)return a.expressions;var c=[];return b.forEach(a.parts,function(a){b.isFunction(a)&&c.push(a.exp)}),c},n=function(a,c,d,e){b.forEach(m(c),function(b){var f=d.$watch(b,function(){e.ncyBreadcrumbLabel=c(d)});a.push(f)})},o=function(a){b.forEach(a,function(a){a()})};j.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$state"],k.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$state"],l.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$state"],b.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",i).directive("ncyBreadcrumb",j).directive("ncyBreadcrumbLast",k).directive("ncyBreadcrumbText",l)}(window,window.angular);